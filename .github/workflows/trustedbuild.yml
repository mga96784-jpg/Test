name: Trusted Signing of payload.json via SignPath

on:
  workflow_dispatch:

jobs:
  sign-payload:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Wichtig f√ºr Commit- & Branch-Verfolgung

      - name: Verify payload.json exists
        run: |
          if [ ! -f "payload.json" ]; then
            echo "payload.json nicht gefunden!"
            exit 1
          fi
          cat payload.json

      - name: Upload payload.json to GitHub as artifact
        id: upload-payload
        uses: actions/upload-artifact@v4
        with:
          name: payload-json
          path: payload.json

      - id: optional_step_id
        uses: signpath/github-action-submit-signing-request@v1
        with:
          api-token: ${{ secrets.SIGNPATH_API_TOKEN }}
          organization-id: 'd3694686-eb3d-4e3d-aeb0-e9fff9e397a9'              
          project-slug: 'PoC_HashSigning'            
          signing-policy-slug: 'PoC_Signing'      
          github-artifact-id: ${{ steps.upload-payload.outputs.artifact-id }}
          wait-for-completion: true
          output-artifact-directory: signed-output


